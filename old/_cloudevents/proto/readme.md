# BCC Platform Events proto schema

The protos within this directory hierarchy represent the data within events generated by BCC Platform eventing infrastructure, usually represented as the data attribute within a [CloudEvent](https://cloudevents.io). They are provided as machine-readable schemas, allowing libraries of data types to be created to make it easier to consume events.

## Relationship between protobuf messages and CloudEvent types

There are two protobuf messages that are relevant for any given CloudEvent type:

The "envelope" message (e.g. `ObjectCreatedEvent`) representing the complete CloudEvent, including any extension attributes.
The "data" message (e.g. `ContributionObjectData`)
There is a 1:1 relationship between CloudEvent types and envelope messages, but a many:1 relationship between CloudEvent types and data messages. In other words, many CloudEvent types can use the same data message. For example, every event associated with something happening to a Contribution object uses ContributionObjectData as the data message. Each envelope message specifies the CloudEvent type it's associated with via a proto annotation.

Note that each proto package is versioned, but this version is independent of any API version. It would be possible for a single API version to support multiple event versions, or vice versa.

Our convention for event types is to have a dot-separated list of the following values, in the order:
 - `bccCode` (always) 
 - product (eg. `core`, `contirbution`, `membership`)
 - resource (eg. `person`, `registry`)
 - version (eg. `v1`)
 - action (e.g. `created`, `revoked`)

The "action" is the action that causes the event to be emitted.

The proto package (in the `package` part of each .proto file) must be `bccCode.events`.product`.`version. The .proto files should be in a directory structure where each element of the package name corresponds to a directory. The envelope messages must be in a file named `events.proto`, and the data messages (including any messages they refer to) must be in a file named `data.proto`. The purpose of this separation is to allow the envelope and data messages to coexist, but for consumer libraries to be generated that only contain the data messages.

As a complete example, consider the event that is created when a Contribution object is created:

- Proto files: `bccCode/events/contribution/registry/v1/events.proto` and `bccCode/events/contribution/registry/v1/data.proto`
- Envelope message: `bccCode.events.contribution.registry.v1.ObjectCreatedEvent`
- Data message: `bccCode.events.contribution.registry.v1.ContributionObjectData`
- Event type: `bccCode.cloud.contribution.object.v1.created`

Note that the `events` part of the proto package is not part of the CloudEvent type, for brevity. It's included in the proto package to distinguish event message from those used in APIs.

## Message naming conventions
While not required for technical correctness, we use a suffix of "Event" for all envelope messages, and a suffix of "Data" for all event data messages. 

We avoid the use either "Event" or "Data" as a suffix for messages which aren't envelope messages or event data messages.


## Resources

- [Protocol Buffers Language Guid(proto3)](https://developers.google.com/protocol-buffers/docs/proto3)